# 個票自動生成機能 使用方法

## 概要
寄付者管理システムに個票自動生成機能を追加しました。この機能により、「1ページ目データ整理」と「2ページ目データ整理」のデータから自動的に個票シートを生成できます。

## 機能の特徴

### 1. 自動生成
- 「2ページ目データ整理」シートに新しいデータが追加されると、自動的に個票が生成されます
- 生徒名ごとに個別のシートが作成されます

### 2. 個票ブック
- 個票は「寄付者管理システム_個票」という別のスプレッドシートブックに保存されます
- 既存のブックがある場合は既存のものを使用し、ない場合は新規作成します

### 3. シート命名規則
- 基本：生徒名（例：「山田太郎」）
- 重複時：生徒名_日付（例：「山田太郎_20241201」）

## 個票の構成

### ヘッダー部分
- 学年
- 生徒名
- 振込日
- 振込金額

### 寄付者リスト（15行）
- No.
- 御芳名
- 金額
- 返礼品
- 直接振込日

### 集計部分
- 寄付金合計
- 金額（寄付金合計 - 直接振込金額）
- 直接振込金額
- 負担金
- Tシャツ代
- 激励会負担金

### 返礼品ルール説明
- ¥10,000以上：タオル、お菓子クリアファイル
- ¥5,000~：タオル、クリアファイル、キーホルダー
- ¥5,000未満：クリアファイル
- その他：カスタム設定

## 使用方法

### 1. 自動生成（推奨）
1. 「2ページ目データ整理」シートに新しい寄付者データを追加
2. 1ページ目氏名列に生徒名を入力
3. 自動的に個票が生成されます

### 2. 手動生成
Google Apps Scriptのエディタで以下の関数を実行：

```javascript
// 特定の生徒の個票を生成
generateIndividualReportManually('山田太郎');

// 全生徒の個票を一括生成
generateAllIndividualReports();
```

## データマッピング

### 1ページ目データ整理 → 個票
- 学年 → 学年
- 氏名 → 生徒名
- 振込日 → 振込日
- 振込金額 → 振込金額
- 直接振込金額 → 直接振込金額
- Tシャツ代 → Tシャツ代
- 奨励会負担金 → 激励会負担金

### 2ページ目データ整理 → 個票
- 1ページ目氏名 → 生徒名（フィルタリング用）
- 御芳名 → 御芳名
- 寄付金額 → 金額
- 返礼品 → 返礼品

## エラーハンドリング

### データが見つからない場合
- 生徒情報が見つからない場合：個票は生成されません
- 寄付者データが見つからない場合：個票は生成されません
- エラーログはGoogle Apps Scriptのログで確認できます

### 15行を超える場合
- 寄付者が15人を超える場合、新しいシートが自動的に作成されます
- シート名は「元のシート名_2」「元のシート名_3」となります

## 注意事項

### 1. 権限設定
- 個票ブックへのアクセス権限が必要です
- 初回実行時に権限の承認が必要になる場合があります

### 2. データの整合性
- 1ページ目データ整理と2ページ目データ整理のデータが一致している必要があります
- 生徒名の表記が完全に一致している必要があります

### 3. 実行タイミング
- 自動生成は「2ページ目データ整理」シートの変更を監視します
- 手動生成は任意のタイミングで実行できます

## トラブルシューティング

### 個票が生成されない場合
1. Google Apps Scriptのログを確認
2. 生徒名の表記が一致しているか確認
3. 必要なシートが存在するか確認

### エラーが発生する場合
1. 権限設定を確認
2. データの形式を確認
3. 個票ブックのアクセス権限を確認

## カスタマイズ

### 個票のレイアウト変更
`createIndividualReportTemplate`関数を編集することで、個票のレイアウトを変更できます。

### 自動生成の条件変更
`onEdit`関数を編集することで、自動生成の条件を変更できます。

## サポート

問題が発生した場合は、Google Apps Scriptのログを確認し、エラーメッセージを記録してください。 