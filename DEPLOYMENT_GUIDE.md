# 寄付管理システム デプロイメントガイド

## 概要
このガイドでは、寄付管理システムをGoogle SheetsとGitHub Pagesにデプロイする手順を説明します。

## 前提条件
- Googleアカウント
- GitHubアカウント
- 基本的なWeb開発の知識

## ステップ1: Google Sheetsの準備

### 1.1 新しいスプレッドシートを作成
1. [Google Sheets](https://sheets.google.com)にアクセス
2. 「新しいスプレッドシート」をクリック
3. スプレッドシートの名前を「寄付管理システム」に変更

### 1.2 シートを設定
以下の3つのシートを作成してください：

#### 設定シート
| 項目 | 値 |
|------|-----|
| 返礼品_ステッカー_最小金額 | 1000 |
| 返礼品_ステッカー_名前 | ステッカー |
| 返礼品_タオル_最小金額 | 3000 |
| 返礼品_タオル_名前 | タオル |
| 返礼品_Tシャツ_最小金額 | 5000 |
| 返礼品_Tシャツ_名前 | Tシャツ |
| 返礼品_フーディー_最小金額 | 10000 |
| 返礼品_フーディー_名前 | フーディー |

#### 寄付データシート
| 送信日時 | 代表者名 | 代表者電話番号 | チーム名 | 大会名 | 寄付者名 | 電話番号 | メールアドレス | 寄付金額 | 返礼品 | 備考 |

#### 統計シート
| 日付 | チーム名 | 寄付者数 | 合計金額 |

### 1.3 スプレッドシートIDを取得
1. スプレッドシートのURLをコピー
2. URLからスプレッドシートIDを抽出（`/d/`と`/edit`の間の文字列）

## ステップ2: Google Apps Scriptの設定

### 2.1 Apps Scriptプロジェクトを作成
1. [Google Apps Script](https://script.google.com)にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「寄付管理システム」に変更

### 2.2 コードを配置
1. `google-apps-script.gs`の内容をコピー
2. Apps Scriptエディタに貼り付け
3. `SPREADSHEET_ID`を実際のスプレッドシートIDに変更

### 2.3 Webアプリとしてデプロイ
1. 「デプロイ」→「新しいデプロイ」をクリック
2. 種類を「ウェブアプリ」に設定
3. 次のユーザーとして実行：「自分」
4. アクセスできるユーザー：「全員」
5. 「デプロイ」をクリック
6. 承認を求められたら「許可」をクリック
7. 生成されたURLをコピー

## ステップ3: フロントエンドの設定

### 3.1 GitHubリポジトリの準備
1. GitHubで新しいリポジトリを作成
2. リポジトリ名を「donation-management-system」に設定
3. リポジトリをクローン

### 3.2 ファイルをアップロード
以下のファイルをリポジトリにアップロード：
- `index.html`
- `css/style.css`
- `js/form.js`
- `js/calculator.js`
- `js/sheets.js`
- `README.md`

### 3.3 Google Apps Script URLを設定
1. `js/sheets.js`を開く
2. `scriptUrl`を実際のApps Script URLに変更

### 3.4 GitHub Pagesを有効化
1. リポジトリの「Settings」タブをクリック
2. 「Pages」セクションを開く
3. Sourceを「Deploy from a branch」に設定
4. Branchを「main」に設定
5. 「Save」をクリック

## ステップ4: テストと検証

### 4.1 基本機能のテスト
1. GitHub PagesのURLにアクセス
2. フォームが正常に表示されることを確認
3. 寄付者を追加する機能をテスト
4. 金額入力と自動計算をテスト
5. 返礼品の自動選択をテスト

### 4.2 Google Sheets連携のテスト
1. テストデータを入力して送信
2. Google Sheetsにデータが保存されることを確認
3. 統計シートが更新されることを確認

### 4.3 エラーハンドリングのテスト
1. 必須項目を空にして送信を試行
2. 無効なデータを入力して送信を試行
3. エラーメッセージが適切に表示されることを確認

## ステップ5: 本番環境の設定

### 5.1 セキュリティ設定
1. Google Sheetsの共有設定を確認
2. 必要に応じてアクセス権限を調整
3. Apps Scriptの実行権限を確認

### 5.2 通知設定
1. 管理者のメールアドレスを設定
2. 通知メールのテンプレートをカスタマイズ
3. 通知の有効/無効を設定

### 5.3 バックアップ設定
1. 定期的なデータバックアップを設定
2. 設定ファイルのバックアップを設定

## トラブルシューティング

### よくある問題と解決方法

#### 1. CORSエラー
- Apps ScriptのCORS設定を確認
- フロントエンドのURLが許可されているか確認

#### 2. データが保存されない
- Apps Scriptの権限を確認
- スプレッドシートIDが正しいか確認
- シート名が正しいか確認

#### 3. フォームが表示されない
- GitHub Pagesの設定を確認
- ファイルパスが正しいか確認
- ブラウザのコンソールでエラーを確認

#### 4. 計算が正しく動作しない
- JavaScriptファイルが正しく読み込まれているか確認
- ブラウザのコンソールでエラーを確認

## 運用・保守

### 定期的な作業
1. データのバックアップ
2. 設定の更新
3. 統計の確認
4. エラーログの確認

### 更新手順
1. ローカルで変更をテスト
2. GitHubにプッシュ
3. 本番環境で動作確認
4. 必要に応じてApps Scriptを更新

## サポート

問題が発生した場合は、以下を確認してください：
1. ブラウザのコンソールでエラーメッセージを確認
2. Apps Scriptのログを確認
3. Google Sheetsの権限設定を確認
4. ネットワーク接続を確認

## 追加機能の実装

将来的に追加できる機能：
- 管理者ダッシュボード
- データエクスポート機能
- 高度な統計分析
- モバイルアプリ
- 多言語対応 